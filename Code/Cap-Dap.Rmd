---
title: "Cap-Dap"
author: "Anna"
date: "11/8/2022"
output: html_document
---

# Introduction
I have been collecting zooplankton (Aglaodiaptomus leptopus) from a bog in Sevey’s Point and in the lab I anesthetize and photograph them under a microscope. I then import those photos into Photoshop and take an average of the total body color of each specimen. I record the color values L, a, and b (variables in my data sheet) which represent luminosity, the red vs. green scale, and the blue vs. yellow scale, respectively. After recording these initial values, I leave the zoopl. under different light treatments for 7 days and record how their pigment color changes over the course of the week. Under my “treatment” variable in my data you will see the values “D” and “NL” which represent darkness and natural light treatments, respectively. For my project, I would like to create statistical models showing if these three color elements of the zoopl. pigment change significantly over the course of the week, and if different light treatments produce significantly different results.

# Preliminary steps
Setting things up:
```{r}
rm(list=ls())
library(here)
library(tidyverse)
library(ggfortify)
```

Importing the data:
```{r}
DF <- read.csv(here("Data", "biostats_copepod_data.csv"))
View(DF)
```
Before importing my data, I ensured that it was "tidy" by appropriately naming column headers without spaces or special characters. For the variables I am interested in working with, I organized the data so that there is only one variable per cell. 

Please see the metadata in the "Data" folder of this project for explanation of the variables included in the data.

I need to convert treatment and before_after from character data to factor data:
```{r}
DF$treatment <- as.factor(DF$treatment)
DF$before_after <- as.factor(DF$before_after)

levels(DF$treatment)
levels(DF$before_after)
```
Since there are only 2 levels in each variable, I don't need to revel them. 

# Analysis

For looking at the data, I will be following this workflow:

Plot > Guess relationships > Create model > Guess model assumptions > Run/interpret model > Replot to show key relationships

## Looking at the data for luminosity:
```{r}
ggplot(DF, aes(x = before_after, y = L)) +
geom_boxplot() +
xlab("Treatment") +
ylab("Luminosity") +
theme_bw() +
facet_wrap(~treatment) +
scale_x_discrete(limits = c("before", "after"))
```
Based on this plot, I make an assumption that luminosity increases significantly after the copepods have been in natural light and darkness treatments for 7 days. In other words, their pigment fades under these light treatments. 

Now, let's create a stats model to take a closer look at the relationship:
```{r}
t.test(L ~ before_after, data = DF)
# this does not separate the different light treatments, but shows that for both natural light and darkness treatments, the pigmentation of the copepods fades during a 7-day period
```
The p-value from this test is <0.05, so we reject the null hypothesis that there is no significant difference in the luminosity value between the before and after groups for natural light and darkness treatments. 

While this is helpful to see, I want to answer the question **Does the effect of the before and after measurements on L depend on what kind of light treatment the copepods were exposed to?** I will do that by running a generalized linear model.

I need to use glm with poisson as the family because L is not on a continuous scale.
```{r}
model_L <- glm(L ~ treatment * before_after, data = DF, family = poisson)
```

Now to check assumptions:
```{r}
autoplot(model_L, smooth.color = NA)
```
Residuals and distribution look good, so we can move on to looking at the model. 

Now I will look at the model
```{r}
anova(model_L)
```

...and look at the summary
```{r}
summary(model_L)
```

By looking at this output, I can see that there is significant difference between before and after luminosity results, but the light treatments themselves did not affect luminosity differently, even though the lines appear to cross each other on the interaction plot.

First I need to get the means to compare, so I have to use group by and summarize:
```{r}
sumDF <- DF %>%
  group_by(treatment, before_after) %>%
  summarize(meanL = mean(L))
```

This is what that interaction plot looks like:
```{r}
ggplot(sumDF, aes(before_after, meanL, color = treatment, group = treatment)) +
  geom_point() +
  geom_line() +
  theme_bw() +
  scale_x_discrete(limits = c("before", "after")) +
  xlab("Treatment") +
  ylab("Mean luminosity (L)")
```
This plot shows the relationship that for both darkness (D) and natural light (NL) treatments, the mean luminosity value after the 7-day trial is significantly different than the initial luminosity value. In summary, both treatments caused the copepod pigmentation to fade and become more luminous. Despite the fact that the lines interact, this plot shows that the slopes of lines are not dramatically different, which is why I concluded that the different treatments themselves did not affect luminosity differently. 

## Looking at the a-value

```{r}
ggplot(DF, aes(x = before_after, y = a)) +
geom_boxplot() +
xlab("Treatment") +
ylab("a") +
theme_bw() +
facet_wrap(~treatment)+
scale_x_discrete(limits = c("before", "after"))
```
Testing significant difference between before and after data
```{r}
t.test(a ~ before_after, data = DF)
```
p-value <0.05 (sig diff)

## Looking at the b-value

```{r}
ggplot(DF, aes(x = before_after, y = b)) +
geom_boxplot() +
xlab("Treatment") +
ylab("b") +
theme_bw() +
facet_wrap(~treatment)+
scale_x_discrete(limits = c("before", "after"))
```
And testing the sig diff for b
```{r}
t.test(b ~ before_after, data = DF)
```
p-value = 0.05384 (no sig diff)




# Biological Summary


# Challenges



